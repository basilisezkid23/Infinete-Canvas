<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Windows 7 Style Infinite Canvas</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap');

  /* Reset & basics */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%; overflow: hidden;
    background: linear-gradient(180deg, #f2f6fb 0%, #f7f7f9 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Top Toolbar */
  .toolbar {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 40px;
    background: rgba(255 255 255 / 0.8);
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0 12px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.06);
    backdrop-filter: blur(8px);
    z-index: 999;
  }
  .btn {
    background: #fff;
    border: 1.5px solid rgba(0,0,0,0.15);
    border-radius: 5px;
    padding: 5px 12px;
    margin-right: 8px;
    font-weight: 600;
    font-size: 13px;
    color: #222;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s ease, box-shadow 0.2s ease;
  }
  .btn:hover {
    background: #e6eaff;
    box-shadow: 0 0 8px #6c7ae0aa;
  }
  .btn:active {
    transform: translateY(1px);
  }

  /* Greece honor button top right */
  #greeceBtn {
    margin-left: auto;
    background: #0033a0;
    color: #fff;
    font-weight: 700;
    font-size: 12px;
    padding: 5px 14px;
    border: none;
    border-radius: 6px;
    box-shadow: 0 0 12px #0033a0aa;
    user-select: none;
  }
  #greeceBtn:hover {
    background: #002070;
  }

  /* Centered carousel container */
  #carousel-container {
    position: absolute;
    top: 50%; left: 50%;
    width: 700px; height: 500px;
    margin-left: -350px;
    margin-top: -250px;
    perspective: 1200px;
    user-select: none;
  }

  /* Carousel */
  #carousel {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.7s cubic-bezier(0.4,0,0.2,1);
    cursor: grab;
  }
  #carousel:active {
    cursor: grabbing;
    transition: none;
  }

  /* Each item */
  .carousel-item {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 240px;
    height: 160px;
    margin: -80px -120px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    background: rgba(255 255 255 / 0.85);
    backdrop-filter: saturate(180%) blur(12px);
    border: 1px solid rgba(255 255 255 / 0.5);
    overflow: hidden;
    transition: box-shadow 0.3s ease;
  }
  .carousel-item img,
  .carousel-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
  }
  .carousel-item video {
    background: black;
  }
  .carousel-item:hover {
    box-shadow: 0 10px 30px rgba(60,60,100,0.3);
  }

  /* Playback overlay */
  #playbackOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    z-index: 1500;
  }
  #playbackOverlay.active {
    opacity: 1;
    pointer-events: auto;
  }
  #playbackOverlay video {
    max-width: 90vw;
    max-height: 70vh;
    border-radius: 10px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.8);
    background: black;
  }

  /* Playback controls */
  #playbackControls {
    margin-top: 10px;
    width: 90vw;
    max-width: 700px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 18px;
    background: rgba(255 255 255 / 0.1);
    border-radius: 10px;
    padding: 8px 12px;
    backdrop-filter: saturate(200%) blur(20px);
  }
  #playbackControls button {
    background: transparent;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: color 0.2s ease;
  }
  #playbackControls button:hover {
    color: #6c7ae0;
  }

  /* Icons from Unicode and some ASCII for simplicity */
  .icon-play::before { content: "‚ñ∂"; }
  .icon-pause::before { content: "‚è∏"; }
  .icon-forward::before { content: "‚è©"; }
  .icon-rewind::before { content: "‚è™"; }
  .icon-exit::before { content: "‚úï"; }
  .icon-mute::before { content: "üîá"; }
  .icon-unmute::before { content: "üîä"; }

  /* Flash colors for Easter egg */
  #flashOverlay {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1400;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  /* Greece honor overlay */
  #greeceOverlay {
    position: fixed;
    inset: 0;
    background: black;
    color: white;
    font-size: 22px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 0 20px;
    opacity: 0;
    pointer-events: none;
    user-select: none;
    z-index: 2000;
    transition: opacity 3s ease;
  }
  #greeceOverlay p {
    margin-bottom: 24px;
    max-width: 700px;
    line-height: 1.5;
    white-space: pre-line;
  }
  #greeceOverlay video {
    max-width: 80vw;
    max-height: 60vh;
    border-radius: 10px;
    box-shadow: 0 10px 40px rgba(255,255,255,0.8);
  }

</style>
</head>
<body>

  <div class="toolbar">
    <button id="exportBtn" class="btn">Export HTML</button>
    <button id="greeceBtn" title="For my country Greece">üá¨üá∑ Honor Greece</button>
  </div>

  <div id="carousel-container" aria-label="Files carousel" role="list"></div>

  <!-- Playback overlay -->
  <div id="playbackOverlay" aria-modal="true" role="dialog" aria-hidden="true">
    <video id="playbackVideo" playsinline></video>
    <div id="playbackControls">
      <button id="btnExit" aria-label="Exit video playback" class="icon-exit"></button>
      <button id="btnRewind" aria-label="Rewind 10 seconds" class="icon-rewind"></button>
      <button id="btnPlayPause" aria-label="Play/Pause" class="icon-play"></button>
      <button id="btnForward" aria-label="Fast forward 10 seconds" class="icon-forward"></button>
      <button id="btnMute" aria-label="Mute/Unmute" class="icon-unmute"></button>
    </div>
  </div>

  <!-- Flash overlay for easter egg -->
  <canvas id="flashOverlay"></canvas>

  <!-- Greece honor overlay -->
  <div id="greeceOverlay" aria-live="assertive">
    <p>This, to whoever is watching this, is for my country Greece, for Macedonia..</p>
    <video id="greeceVideo" controls></video>
  </div>

<script>
(() => {
  // Globals
  const carouselContainer = document.getElementById('carousel-container');
  const playbackOverlay = document.getElementById('playbackOverlay');
  const playbackVideo = document.getElementById('playbackVideo');
  const playbackControls = document.getElementById('playbackControls');
  const btnExit = document.getElementById('btnExit');
  const btnPlayPause = document.getElementById('btnPlayPause');
  const btnForward = document.getElementById('btnForward');
  const btnRewind = document.getElementById('btnRewind');
  const btnMute = document.getElementById('btnMute');
  const flashCanvas = document.getElementById('flashOverlay');
  const greeceBtn = document.getElementById('greeceBtn');
  const greeceOverlay = document.getElementById('greeceOverlay');
  const greeceVideo = document.getElementById('greeceVideo');

  // Easter egg audio
  const easterEggAudio = new Audio('https://raw.githubusercontent.com/basilisezkid23/Infinete-Canvas/main/Lensko%20-%20Let\'s%20Go_%20_%20House%20_%20NCS%20-%20Copyright%20Free%20Music%20%5BmSLuJYtl89Y%5D.mp3');
  easterEggAudio.preload = 'auto';
  easterEggAudio.loop = false;
  easterEggAudio.volume = 0.75;

  // Greece video source
  greeceVideo.src = 'https://raw.githubusercontent.com/basilisezkid23/Infinete-Canvas/main/macedonia%20is%20greek.mp4';

  // State
  let files = [];
  let rotationY = 0;
  let isDragging = false;
  let dragStartX = 0;
  let lastRotationY = 0;
  let isPlaying = false;
  let isMuted = false;
  let currentIndex = null;
  let easterEggSequence = [];
  let easterEggActive = false;
  let flashCtx;
  let flashAnimationFrame;

  // Flash canvas setup
  function setupFlashCanvas() {
    flashCanvas.width = window.innerWidth;
    flashCanvas.height = window.innerHeight;
    flashCanvas.style.position = 'fixed';
    flashCanvas.style.top = '0';
    flashCanvas.style.left = '0';
    flashCanvas.style.zIndex = '1400';
    flashCanvas.style.pointerEvents = 'none';
    flashCtx = flashCanvas.getContext('2d');
  }
  setupFlashCanvas();
  window.addEventListener('resize', setupFlashCanvas);

  // Create carousel item
  function createCarouselItem(file, index) {
    const item = document.createElement('div');
    item.className = 'carousel-item';
    item.dataset.index = index;
    item.setAttribute('role', 'listitem');
    if (file.type.startsWith('image')) {
      const img = document.createElement('img');
      img.src = file.url;
      img.alt = file.name;
      item.appendChild(img);
    } else if (file.type.startsWith('video')) {
      const vid = document.createElement('video');
      vid.src = file.url;
      vid.muted = true; // start muted on carousel
      vid.loop = true;
      vid.autoplay = true;
      vid.playsInline = true;
      vid.style.pointerEvents = 'none';
      vid.style.userSelect = 'none';
      item.appendChild(vid);
    }
    // click to open playback
    item.addEventListener('click', (e) => {
      if (isDragging) return; // prevent open on drag end
      openPlayback(index);
    });
    return item;
  }

  // Update carousel positions & transform
  function updateCarouselPositions() {
    const count = files.length;
    if (count === 0) {
      carouselContainer.innerHTML = '';
      return;
    }
    const angleStep = 360 / count;
    files.forEach((file, i) => {
      const item = carouselContainer.querySelector(`.carousel-item[data-index="${i}"]`);
      if (!item) return;
      const angle = angleStep * i + rotationY;
      // place items in a circle with some Z-depth
      const radius = 350;
      const rad = (angle * Math.PI) / 180;
      const x = radius * Math.sin(rad);
      const z = radius * Math.cos(rad);
      item.style.transform = `translateX(${x}px) translateZ(${z}px) translateY(-50%)`;
      item.style.zIndex = Math.round(z);
      // optionally highlight the item closest to front
      item.style.filter = z > 0 ? 'brightness(1)' : 'brightness(0.6)';
      item.style.pointerEvents = z > 0 ? 'auto' : 'none';
    });
  }

  // Initialize carousel DOM
  function initCarousel() {
    carouselContainer.innerHTML = '';
    files.forEach((file, i) => {
      const item = createCarouselItem(file, i);
      carouselContainer.appendChild(item);
    });
  }

  // Rotate carousel
  function rotateCarousel(deltaX) {
    rotationY = lastRotationY + deltaX * 0.5;
    updateCarouselPositions();
  }

  // Handle drag start
  function onDragStart(e) {
    isDragging = true;
    dragStartX = e.clientX || (e.touches && e.touches[0].clientX);
    lastRotationY = rotationY;
  }
  // Handle drag move
  function onDragMove(e) {
    if (!isDragging) return;
    const clientX = e.clientX || (e.touches && e.touches[0].clientX);
    const deltaX = clientX - dragStartX;
    rotateCarousel(deltaX);
  }
  // Handle drag end
  function onDragEnd(e) {
    if (!isDragging) return;
    isDragging = false;
    // Snap rotation to allow smooth free rotation (no locking)
    lastRotationY = rotationY;
  }

  // Open video/image playback
  function openPlayback(index) {
    if (index === null || index < 0 || index >= files.length) return;
    const file = files[index];
    currentIndex = index;
    if (file.type.startsWith('image')) {
      // For images, just fullscreen display
      showImageFullscreen(file.url);
    } else if (file.type.startsWith('video')) {
      openVideoPlayback(file.url);
    }
  }

  // Show image fullscreen (simple)
  function showImageFullscreen(url) {
    playbackOverlay.classList.add('active');
    playbackVideo.style.display = 'none';

    // Create or reuse fullscreen img element
    let img = playbackOverlay.querySelector('img.fullscreen-image');
    if (!img) {
      img = document.createElement('img');
      img.className = 'fullscreen-image';
      img.style.maxWidth = '90vw';
      img.style.maxHeight = '90vh';
      img.style.borderRadius = '12px';
      img.style.boxShadow = '0 10px 40px rgba(0,0,0,0.8)';
      playbackOverlay.insertBefore(img, playbackControls);
    }
    img.src = url;
    img.style.display = 'block';

    playbackControls.style.display = 'none'; // no controls for images

    playbackOverlay.setAttribute('aria-hidden', 'false');
  }

  // Open video playback UI
  function openVideoPlayback(url) {
    playbackOverlay.classList.add('active');
    playbackVideo.style.display = 'block';
    // Remove fullscreen image if exists
    const img = playbackOverlay.querySelector('img.fullscreen-image');
    if (img) img.style.display = 'none';

    playbackVideo.src = url;
    playbackVideo.muted = isMuted;
    playbackVideo.play();

    playbackControls.style.display = 'flex';

    playbackOverlay.setAttribute('aria-hidden', 'false');
    isPlaying = true;
    updatePlayPauseButton();
  }

  // Close playback
  function closePlayback() {
    playbackOverlay.classList.remove('active');
    playbackVideo.pause();
    playbackVideo.src = '';
    const img = playbackOverlay.querySelector('img.fullscreen-image');
    if (img) img.style.display = 'none';
    playbackOverlay.setAttribute('aria-hidden', 'true');
    currentIndex = null;
  }

  // Playback controls handlers
  btnExit.onclick = () => closePlayback();
  btnPlayPause.onclick = () => {
    if (playbackVideo.paused) {
      playbackVideo.play();
      isPlaying = true;
    } else {
      playbackVideo.pause();
      isPlaying = false;
    }
    updatePlayPauseButton();
  };
  btnForward.onclick = () => {
    playbackVideo.currentTime = Math.min(playbackVideo.duration, playbackVideo.currentTime + 10);
  };
  btnRewind.onclick = () => {
    playbackVideo.currentTime = Math.max(0, playbackVideo.currentTime - 10);
  };
  btnMute.onclick = () => {
    isMuted = !isMuted;
    playbackVideo.muted = isMuted;
    updateMuteButton();
  };

  function updatePlayPauseButton() {
    btnPlayPause.className = isPlaying ? 'icon-pause' : 'icon-play';
  }
  function updateMuteButton() {
    btnMute.className = isMuted ? 'icon-mute' : 'icon-unmute';
  }

  // Keyboard handlers for playback overlay
  window.addEventListener('keydown', (e) => {
    if (!playbackOverlay.classList.contains('active')) return;
    if (e.key === 'Escape') {
      closePlayback();
    } else if (e.key === ' ') {
      e.preventDefault();
      btnPlayPause.click();
    } else if (e.key === 'ArrowRight') {
      btnForward.click();
    } else if (e.key === 'ArrowLeft') {
      btnRewind.click();
    } else if (e.key.toLowerCase() === 'm') {
      btnMute.click();
    }
  });

  // Prevent scrolling with mouse wheel from triggering clicks or weird behavior
  carouselContainer.addEventListener('wheel', (e) => {
    e.preventDefault();
    // Instead rotate carousel based on wheel delta
    rotationY += e.deltaY * 0.3;
    lastRotationY = rotationY;
    updateCarouselPositions();
  }, { passive: false });

  // Drag handlers for carousel
  carouselContainer.addEventListener('mousedown', onDragStart);
  window.addEventListener('mousemove', onDragMove);
  window.addEventListener('mouseup', onDragEnd);

  carouselContainer.addEventListener('touchstart', onDragStart);
  window.addEventListener('touchmove', onDragMove);
  window.addEventListener('touchend', onDragEnd);

  // Load sample files (replace with your own images/videos URLs or extend)
  function loadSampleFiles() {
    files = [
      { name: 'Windows 7 Desktop', url: 'https://i.imgur.com/zOaOfxZ.jpg', type: 'image/jpeg' },
      { name: 'Example Video', url: 'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm', type: 'video/webm' },
      { name: 'Windows 7 Wallpaper', url: 'https://wallpaperaccess.com/full/1037861.jpg', type: 'image/jpeg' },
      { name: 'Demo Video', url: 'https://media.w3.org/2010/05/sintel/trailer.mp4', type: 'video/mp4' }
    ];
  }

  // Initialize
  function init() {
    loadSampleFiles();
    initCarousel();
    rotationY = 0;
    updateCarouselPositions();
  }

  // Easter egg key sequence "G" pressed 4 times fast
  window.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'g') {
      easterEggSequence.push(Date.now());
      // Keep last 4 presses in 5 seconds window
      easterEggSequence = easterEggSequence.filter(t => Date.now() - t < 5000);
      if (easterEggSequence.length >= 4 && !easterEggActive) {
        startEasterEgg();
        easterEggSequence = [];
      }
    }
  });

  // Easter egg flash animation
  const flashColors = ['red', 'green', 'blue'];
  function flashSequence(duration = 20000) {
    let start = null;
    let idx = 0;
    function step(timestamp) {
      if (!start) start = timestamp;
      const elapsed = timestamp - start;
      if (elapsed >= duration) {
        flashCtx.clearRect(0, 0, flashCanvas.width, flashCanvas.height);
        flashCanvas.style.opacity = 0;
        return;
      }
      flashCanvas.style.opacity = 0.8;
      flashCtx.fillStyle = flashColors[idx % flashColors.length];
      flashCtx.fillRect(0, 0, flashCanvas.width, flashCanvas.height);
      idx++;
      flashAnimationFrame = requestAnimationFrame(step);
    }
    flashAnimationFrame = requestAnimationFrame(step);
  }

  function startEasterEgg() {
    easterEggActive = true;
    // Hide carousel
    carouselContainer.style.display = 'none';
    // Play audio
    easterEggAudio.currentTime = 0;
    easterEggAudio.play();

    // Start flashing
    flashSequence(20000);

    // After 20s end
    setTimeout(() => {
      easterEggAudio.pause();
      carouselContainer.style.display = 'block';
      easterEggActive = false;
      cancelAnimationFrame(flashAnimationFrame);
      flashCanvas.style.opacity = 0;
      flashCtx.clearRect(0, 0, flashCanvas.width, flashCanvas.height);
    }, 20000);
  }

  // Export HTML button - simple alert with placeholder for demo
  document.getElementById('exportBtn').onclick = () => {
    alert('Export functionality not implemented yet.');
  };

  // Greece honor button click handler
  greeceBtn.addEventListener('click', () => {
    // Hide everything except overlay
    document.body.style.overflow = 'hidden';
    document.body.style.background = 'black';
    carouselContainer.style.display = 'none';
    playbackOverlay.classList.remove('active');
    greeceOverlay.style.pointerEvents = 'auto';
    greeceOverlay.style.opacity = '1';

    // Play text fade in
    greeceOverlay.querySelector('p').style.opacity = 0;
    let textOpacity = 0;
    const fadeInInterval = setInterval(() => {
      textOpacity += 0.01;
      greeceOverlay.querySelector('p').style.opacity = textOpacity;
      if (textOpacity >= 1) clearInterval(fadeInInterval);
    }, 30);

    // Play video after 4 seconds delay for text
    setTimeout(() => {
      greeceVideo.play();
    }, 4000);

    // When video ends, revert everything
    greeceVideo.onended = () => {
      greeceOverlay.style.opacity = '0';
      greeceOverlay.style.pointerEvents = 'none';
      document.body.style.overflow = '';
      document.body.style.background = '';
      carouselContainer.style.display = 'block';
      greeceVideo.pause();
      greeceVideo.currentTime = 0;
    };
  });

  // Initialize everything on page load
  window.onload = init;

})();
</script>

</body>
</html>
