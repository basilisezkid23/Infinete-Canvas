<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Windows 7 Style Carousel with Video Playback & Easter Egg</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0;
    height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(180deg, #e3eaf6 0%, #f7f9fc 100%);
    overflow: hidden;
    user-select: none;
  }

  /* Instructions Overlay */
  #instructions-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    padding: 20px;
    text-align: left;
  }
  #instructions-content {
    background: rgba(30,30,30,0.95);
    border-radius: 15px;
    padding: 30px 40px;
    max-width: 480px;
    box-shadow: 0 0 25px rgba(255 255 255 / 0.3);
  }
  #instructions-content h2 {
    margin-top: 0;
    font-weight: 700;
    font-size: 1.9rem;
    margin-bottom: 15px;
    text-align: center;
  }
  #instructions-content ul {
    padding-left: 20px;
    margin-bottom: 25px;
    font-size: 1.1rem;
    line-height: 1.5;
  }
  #close-instructions {
    display: block;
    margin: 0 auto;
    background: #0078d7;
    border: none;
    color: white;
    padding: 12px 25px;
    border-radius: 12px;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s ease;
    user-select: none;
  }
  #close-instructions:hover {
    background: #005a9e;
  }

  /* Tribute button top-right */
  #tribute-btn {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #0078d7;
    border-radius: 8px;
    color: white;
    font-size: 18px;
    padding: 6px 10px;
    cursor: pointer;
    user-select: none;
    z-index: 999;
    transition: background 0.3s ease;
  }
  #tribute-btn:hover {
    background: #005a9e;
  }

  /* Fullscreen tribute overlay */
  #tribute-overlay {
    position: fixed;
    inset: 0;
    background: black;
    color: white;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
    z-index: 10000;
  }
  #tribute-text {
    font-size: 2rem;
    max-width: 600px;
    margin-bottom: 20px;
    opacity: 0;
    transition: opacity 3s ease;
    text-align: center;
    line-height: 1.3;
  }
  #tribute-video {
    max-width: 90vw;
    max-height: 50vh;
    border-radius: 12px;
    box-shadow: 0 0 25px rgba(255 255 255 / 0.5);
  }

  /* Carousel Container */
  #carousel-container {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    width: 700px;
    height: 400px;
    perspective: 1200px;
    user-select: none;
  }

  /* Carousel */
  #carousel {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: grab;
  }

  /* Carousel item */
  .carousel-item {
    position: absolute;
    width: 240px;
    height: 160px;
    left: 50%;
    top: 50%;
    margin-left: -120px;
    margin-top: -80px;
    border-radius: 12px;
    box-shadow:
      0 4px 8px rgba(0,0,0,0.3),
      0 0 15px rgba(0,0,0,0.15);
    background: #222;
    overflow: hidden;
    backface-visibility: hidden;
    transition:
      transform 0.7s cubic-bezier(0.4, 0, 0.2, 1),
      box-shadow 0.3s ease;
  }

  .carousel-item img,
  .carousel-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    user-select: none;
    pointer-events: none;
  }

  .carousel-item video {
    pointer-events: auto; /* for playback controls */
  }

  .carousel-item:hover {
    box-shadow:
      0 12px 24px rgba(0,0,0,0.6),
      0 0 40px rgba(0,0,0,0.3);
  }

  /* Playback UI */
  #playback-ui {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255 255 255 / 0.15);
    backdrop-filter: saturate(180%) blur(12px);
    border-radius: 20px;
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 20px;
    width: 350px;
    max-width: 90vw;
    color: white;
    font-size: 0;
    user-select: none;
    box-shadow: 0 0 15px rgba(255,255,255,0.3);
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 9999;
  }
  #playback-ui.visible {
    visibility: visible;
    opacity: 1;
  }
  #playback-ui button {
    background: transparent;
    border: none;
    color: white;
    font-size: 22px;
    cursor: pointer;
    user-select: none;
    outline-offset: 2px;
    transition: color 0.2s ease;
  }
  #playback-ui button:hover {
    color: #0078d7;
  }
  #playback-ui button:focus {
    outline: 2px solid #0078d7;
    outline-offset: 2px;
  }

  /* Icons for buttons (simple SVG inline) */
  #playback-ui button svg {
    fill: currentColor;
    width: 20px;
    height: 20px;
  }

</style>
</head>
<body>

<!-- Instructions Overlay -->
<div id="instructions-overlay" role="dialog" aria-modal="true" aria-label="How to use instructions">
  <div id="instructions-content">
    <h2>How to Use</h2>
    <ul>
      <li>Drag and drop images or videos onto the carousel below to add them.</li>
      <li>Click or tap on an item to open it (videos play with controls).</li>
      <li>Drag left/right on the carousel to rotate through items smoothly.</li>
      <li>Press <strong>G</strong> 4 times quickly for a surprise Easter egg!</li>
      <li>Use the playback controls at the bottom for video control.</li>
      <li>Click the ðŸ‡¬ðŸ‡· Tribute button at the top right for a special message.</li>
      <li>Press ESC to exit video playback.</li>
    </ul>
    <button id="close-instructions">Got it!</button>
  </div>
</div>

<!-- Tribute button -->
<button id="tribute-btn" title="Tribute to Greece ðŸ‡¬ðŸ‡·">ðŸ‡¬ðŸ‡·</button>

<!-- Tribute overlay -->
<div id="tribute-overlay" aria-hidden="true" role="dialog" aria-modal="true" tabindex="-1">
  <div id="tribute-text"></div>
  <video id="tribute-video" controls preload="auto" crossorigin="anonymous"></video>
</div>

<!-- Carousel container -->
<div id="carousel-container" aria-label="Image and video carousel" role="list"></div>

<!-- Playback UI -->
<div id="playback-ui" aria-label="Video playback controls">
  <button id="playback-exit" title="Exit video playback" aria-label="Exit video playback">
    <!-- X icon -->
    <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
  </button>
  <button id="playback-rewind" title="Rewind 5 seconds" aria-label="Rewind 5 seconds">
    <!-- rewind icon -->
    <svg viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </button>
  <button id="playback-play" title="Play/Pause" aria-label="Play or pause video">
    <!-- play icon -->
    <svg id="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    <svg id="pause-icon" viewBox="0 0 24 24" style="display:none;"><rect x="6" y="5" width="4" height="14"/><rect x="14" y="5" width="4" height="14"/></svg>
  </button>
  <button id="playback-forward" title="Fast forward 5 seconds" aria-label="Fast forward 5 seconds">
    <!-- forward icon -->
    <svg viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </button>
  <button id="playback-mute" title="Mute/Unmute" aria-label="Mute or unmute video">
    <!-- speaker icon -->
    <svg id="volume-on-icon" viewBox="0 0 24 24"><path d="M5 9v6h4l5 5V4L9 9H5z"/></svg>
    <svg id="volume-off-icon" viewBox="0 0 24 24" style="display:none;"><path d="M16 7l-1.41-1.41L12 8.17 9.41 5.59 8 7l3 3-3 3 1.41 1.41L12 13.83l2.59 2.58L16 17l-3-3 3-3z"/></svg>
  </button>
</div>

<script>
(() => {
  // Elements refs
  const instructionsOverlay = document.getElementById('instructions-overlay');
  const closeInstructionsBtn = document.getElementById('close-instructions');
  const carouselContainer = document.getElementById('carousel-container');
  const playbackUI = document.getElementById('playback-ui');
  const playbackExitBtn = document.getElementById('playback-exit');
  const playbackRewindBtn = document.getElementById('playback-rewind');
  const playbackPlayBtn = document.getElementById('playback-play');
  const playbackForwardBtn = document.getElementById('playback-forward');
  const playbackMuteBtn = document.getElementById('playback-mute');
  const playIcon = document.getElementById('play-icon');
  const pauseIcon = document.getElementById('pause-icon');
  const volumeOnIcon = document.getElementById('volume-on-icon');
  const volumeOffIcon = document.getElementById('volume-off-icon');
  const tributeBtn = document.getElementById('tribute-btn');
  const tributeOverlay = document.getElementById('tribute-overlay');
  const tributeText = document.getElementById('tribute-text');
  const tributeVideo = document.getElementById('tribute-video');

  // Carousel state
  let items = []; // {type: "image"|"video", element, url, rotation}
  let rotationY = 0;
  let isDragging = false;
  let dragStartX = 0;
  let lastRotationY = 0;
  let animationFrameId = null;
  const radius = 350;

  // Playback state
  let currentPlayingIndex = null;
  let currentVideo = null;
  let isMuted = false;

  // Easter egg state
  let easterEggActive = false;
  let easterEggTimeout = null;
  let easterEggColors = ['red', 'green', 'blue'];
  let easterEggColorIndex = 0;
  let easterEggFlashInterval = null;
  const easterEggDuration = 20000; // 20 seconds

  // Easter egg audio
  const easterEggAudio = new Audio('https://raw.githubusercontent.com/basilisezkid23/Infinete-Canvas/main/Lensko%20-%20Let%27s%20Go_%20_%20House%20_%20NCS%20-%20Copyright%20Free%20Music%20%5BmSLuJYtl89Y%5D.mp3');
  easterEggAudio.crossOrigin = "anonymous";
  easterEggAudio.loop = false;

  // Tribute video URL (raw)
  const tributeVideoUrl = 'https://raw.githubusercontent.com/basilisezkid23/Infinete-Canvas/main/macedonia%20is%20greek.mp4';

  // Easter egg key sequence: press G 4 times quickly
  let easterEggKeyCount = 0;
  let easterEggKeyTimeout = null;

  // Helpers

  // Update carousel positions and transforms
  function updateCarouselPositions() {
    const N = items.length;
    if (N === 0) return;
    const anglePerItem = 360 / N;
    items.forEach((item, i) => {
      const itemAngle = rotationY + i * anglePerItem;
      item.rotation = itemAngle;
      const rad = (itemAngle * Math.PI) / 180;
      const x = radius * Math.sin(rad);
      const z = radius * Math.cos(rad);
      // perspective and transform
      item.element.style.transform = `translateX(${x}px) translateZ(${z}px) rotateY(${itemAngle}deg) translateY(-50%) translateX(-50%)`;
      // z-index by depth (higher z means front)
      const depth = Math.cos(rad);
      item.element.style.zIndex = Math.floor((depth + 1) * 100);
      // subtle scale for front items
      const scale = 0.8 + 0.4 * depth;
      item.element.style.opacity = 0.3 + 0.7 * depth;
      item.element.style.pointerEvents = depth > 0.1 ? 'auto' : 'none';
      item.element.style.filter = `drop-shadow(0 4px 8px rgba(0,0,0,${0.3 * depth}))`;
      item.element.style.transition = easterEggActive ? 'none' : 'transform 0.5s cubic-bezier(0.4,0,0.2,1), opacity 0.5s ease';
      item.element.style.scale = scale;
    });
  }

  // Initialize carousel container
  function initCarousel() {
    carouselContainer.innerHTML = '';
    items.forEach(({ element }) => carouselContainer.appendChild(element));
    rotationY = 0;
    updateCarouselPositions();
  }

  // Create item elements
  function createCarouselItem(type, url) {
    const item = document.createElement('div');
    item.className = 'carousel-item';
    item.tabIndex = 0;
    item.setAttribute('role', 'listitem');
    item.setAttribute('aria-label', `${type} item`);

    if (type === 'image') {
      const img = document.createElement('img');
      img.src = url;
      img.alt = 'User added image';
      item.appendChild(img);
    } else if (type === 'video') {
      const video = document.createElement('video');
      video.src = url;
      video.preload = 'metadata';
      video.muted = true;
      video.playsInline = true;
      video.style.pointerEvents = 'none';
      item.appendChild(video);
    }
    return item;
  }

  // Add new item to carousel
  function addItem(type, url) {
    const element = createCarouselItem(type, url);
    items.push({ type, url, element, rotation: 0 });
    initCarousel();
  }

  // Open item playback
  function openItem(index) {
    if (currentPlayingIndex !== null) return; // one video at a time
    const item = items[index];
    if (!item || item.type !== 'video') return;

    currentPlayingIndex = index;
    currentVideo = item.element.querySelector('video');

    if (!currentVideo) return;

    currentVideo.muted = isMuted;
    currentVideo.currentTime = 0;
    currentVideo.play();
    showPlaybackUI(true);
  }

  // Close playback
  function closePlayback() {
    if (currentVideo) {
      currentVideo.pause();
      currentVideo.currentTime = 0;
    }
    currentPlayingIndex = null;
    currentVideo = null;
    showPlaybackUI(false);
  }

  // Show/hide playback UI
  function showPlaybackUI(show) {
    if (show) {
      playbackUI.classList.add('visible');
    } else {
      playbackUI.classList.remove('visible');
    }
  }

  // Playback controls handlers
  playbackExitBtn.addEventListener('click', closePlayback);
  playbackPlayBtn.addEventListener('click', () => {
    if (!currentVideo) return;
    if (currentVideo.paused) {
      currentVideo.play();
      playIcon.style.display = 'none';
      pauseIcon.style.display = 'inline';
    } else {
      currentVideo.pause();
      playIcon.style.display = 'inline';
      pauseIcon.style.display = 'none';
    }
  });
  playbackRewindBtn.addEventListener('click', () => {
    if (!currentVideo) return;
    currentVideo.currentTime = Math.max(0, currentVideo.currentTime - 5);
  });
  playbackForwardBtn.addEventListener('click', () => {
    if (!currentVideo) return;
    currentVideo.currentTime = Math.min(currentVideo.duration, currentVideo.currentTime + 5);
  });
  playbackMuteBtn.addEventListener('click', () => {
    if (!currentVideo) return;
    isMuted = !isMuted;
    currentVideo.muted = isMuted;
    volumeOnIcon.style.display = isMuted ? 'none' : 'inline';
    volumeOffIcon.style.display = isMuted ? 'inline' : 'none';
  });

  // Keyboard controls for playback (ESC to exit)
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && currentPlayingIndex !== null) {
      closePlayback();
    }
  });

  // Carousel drag rotation logic
  carouselContainer.addEventListener('mousedown', e => {
    isDragging = true;
    dragStartX = e.clientX;
    lastRotationY = rotationY;
    carouselContainer.style.cursor = 'grabbing';
    e.preventDefault();
  });
  document.addEventListener('mouseup', e => {
    if (isDragging) {
      isDragging = false;
      carouselContainer.style.cursor = 'grab';
    }
  });
  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const deltaX = e.clientX - dragStartX;
    rotationY = lastRotationY + deltaX * 0.3; // sensitivity
    updateCarouselPositions();
  });

  // Touch support for carousel drag
  carouselContainer.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      isDragging = true;
      dragStartX = e.touches[0].clientX;
      lastRotationY = rotationY;
    }
  }, { passive: true });
  document.addEventListener('touchend', e => {
    isDragging = false;
  });
  document.addEventListener('touchmove', e => {
    if (!isDragging) return;
    if (e.touches.length !== 1) return;
    const deltaX = e.touches[0].clientX - dragStartX;
    rotationY = lastRotationY + deltaX * 0.3;
    updateCarouselPositions();
  }, { passive: true });

  // Click/tap on carousel item to open playback (videos only)
  carouselContainer.addEventListener('click', e => {
    let target = e.target;
    while (target && !target.classList.contains('carousel-item')) {
      target = target.parentElement;
    }
    if (!target) return;
    const idx = items.findIndex(i => i.element === target);
    if (idx === -1) return;
    if (items[idx].type === 'video') {
      openItem(idx);
    }
  });

  // Drag & Drop handlers - FIXED with preventDefault & stopPropagation to avoid browser opening new tabs
  // Also global dragover & drop prevent default to stop any native behavior outside drop zone
  window.addEventListener('dragover', e => e.preventDefault());
  window.addEventListener('drop', e => e.preventDefault());

  carouselContainer.addEventListener('dragover', e => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'copy';
  });
  carouselContainer.addEventListener('drop', e => {
    e.preventDefault();
    e.stopPropagation();

    const files = e.dataTransfer.files;
    if (!files || files.length === 0) return;

    Array.from(files).forEach(file => {
      if (!file.type) return;
      if (file.type.startsWith('image/')) {
        const url = URL.createObjectURL(file);
        addItem('image', url);
      } else if (file.type.startsWith('video/')) {
        const url = URL.createObjectURL(file);
        addItem('video', url);
      }
    });
  });

  // Keyboard easter egg: press G 4 times quickly to activate
  document.addEventListener('keydown', e => {
    if (e.key.toLowerCase() === 'g') {
      easterEggKeyCount++;
      if (easterEggKeyTimeout) clearTimeout(easterEggKeyTimeout);
      easterEggKeyTimeout = setTimeout(() => {
        easterEggKeyCount = 0;
      }, 1000);
      if (easterEggKeyCount === 4) {
        easterEggKeyCount = 0;
        triggerEasterEgg();
      }
    }
  });

  // Easter egg function
  function triggerEasterEgg() {
    if (easterEggActive) return; // Already active

    easterEggActive = true;

    // Flash body background colors cycling
    easterEggFlashInterval = setInterval(() => {
      document.body.style.backgroundColor = easterEggColors[easterEggColorIndex];
      easterEggColorIndex = (easterEggColorIndex + 1) % easterEggColors.length;
    }, 300);

    // Play audio
    easterEggAudio.play();

    // Stop after duration
    setTimeout(() => {
      clearInterval(easterEggFlashInterval);
      document.body.style.backgroundColor = '';
      easterEggActive = false;
      easterEggAudio.pause();
      easterEggAudio.currentTime = 0;
    }, easterEggDuration);
  }

  // Tribute button toggles tribute overlay
  tributeBtn.addEventListener('click', () => {
    if (tributeOverlay.style.display === 'flex') {
      closeTribute();
    } else {
      openTribute();
    }
  });

  function openTribute() {
    tributeOverlay.style.display = 'flex';
    tributeOverlay.setAttribute('aria-hidden', 'false');
    tributeText.style.opacity = '0';
    tributeText.textContent = "Greece forever ðŸ‡¬ðŸ‡· â€” the cradle of democracy and culture.";
    setTimeout(() => {
      tributeText.style.opacity = '1';
    }, 100);

    tributeVideo.src = tributeVideoUrl;
    tributeVideo.volume = 0.3;
    tributeVideo.play();
  }

  function closeTribute() {
    tributeOverlay.style.display = 'none';
    tributeOverlay.setAttribute('aria-hidden', 'true');
    tributeVideo.pause();
    tributeVideo.currentTime = 0;
    tributeVideo.src = '';
  }

  tributeOverlay.addEventListener('click', e => {
    if (e.target === tributeOverlay) {
      closeTribute();
    }
  });

  // Instructions overlay close button
  closeInstructionsBtn.addEventListener('click', () => {
    instructionsOverlay.style.display = 'none';
  });

  // Initial setup
  // Add a nice welcome image and a sample video item for demo
  addItem('image', 'https://upload.wikimedia.org/wikipedia/commons/5/57/Windows_7_Logo.svg');
  addItem('video', 'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm');

  // Initialize carousel container div
  initCarousel();

  // Initial cursor style
  carouselContainer.style.cursor = 'grab';

})();
</script>

</body>
</html>
