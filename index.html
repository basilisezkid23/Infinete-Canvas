<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Windows 7 Style Carousel Canvas with Easter Egg</title>
<style>
  /* Reset */
  * {
    box-sizing: border-box;
    user-select: none;
  }
  html, body {
    height: 100%;
    margin: 0;
    background: linear-gradient(180deg, #dce7f8 0%, #f7f9fc 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  body.easter-egg-flash {
    animation: flashColors 1s linear infinite;
  }
  @keyframes flashColors {
    0% { background-color: #ff0000; }
    33% { background-color: #00ff00; }
    66% { background-color: #0000ff; }
    100% { background-color: #ff0000; }
  }

  #carousel-container {
    position: relative;
    width: 80vw;
    max-width: 900px;
    height: 60vh;
    max-height: 540px;
    perspective: 1500px;
    overflow: visible;
  }

  #carousel {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    cursor: grab;
  }
  #carousel:active {
    cursor: grabbing;
  }

  .carousel-item {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 300px;
    height: 200px;
    margin: -100px -150px;
    border-radius: 12px;
    background: rgba(255,255,255,0.85);
    box-shadow: 0 12px 24px rgba(0,0,0,0.2);
    transition:
      transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      opacity 0.5s ease;
    overflow: hidden;
    user-select: none;
  }

  .carousel-item img,
  .carousel-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
    pointer-events: none;
  }

  /* Playback UI */
  #playback-ui {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255 255 255 / 0.15);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 10px 25px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    width: 320px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 9999;
  }
  #playback-ui.visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* Control buttons */
  .control-btn {
    cursor: pointer;
    width: 26px;
    height: 26px;
    fill: white;
    transition: transform 0.15s ease;
  }
  .control-btn:hover {
    transform: scale(1.2);
  }

  /* Hide video default controls */
  video::-webkit-media-controls {
    display:none !important;
  }

</style>
</head>
<body>
  <div id="carousel-container">
    <div id="carousel"></div>
  </div>

  <!-- Playback controls -->
  <div id="playback-ui" aria-label="Video playback controls">
    <svg id="btn-exit" class="control-btn" viewBox="0 0 24 24" title="Exit playback" role="button" tabindex="0" aria-pressed="false" aria-label="Exit playback">
      <path d="M6 6 L18 18 M18 6 L6 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <svg id="btn-rewind" class="control-btn" viewBox="0 0 24 24" title="Rewind 10s" role="button" tabindex="0" aria-label="Rewind 10 seconds">
      <path d="M11 19V5l-7 7 7 7zM18 19V5l-7 7 7 7z" fill="white"/>
    </svg>
    <svg id="btn-playpause" class="control-btn" viewBox="0 0 24 24" title="Play/Pause" role="button" tabindex="0" aria-label="Play or pause">
      <path id="play-icon" d="M8 5v14l11-7z" fill="white"/>
      <rect id="pause-icon" x="8" y="5" width="3" height="14" fill="white" style="display:none"/>
      <rect id="pause-icon2" x="14" y="5" width="3" height="14" fill="white" style="display:none"/>
    </svg>
    <svg id="btn-forward" class="control-btn" viewBox="0 0 24 24" title="Forward 10s" role="button" tabindex="0" aria-label="Forward 10 seconds">
      <path d="M13 5v14l7-7-7-7zM6 5v14l7-7-7-7z" fill="white"/>
    </svg>
    <svg id="btn-mute" class="control-btn" viewBox="0 0 24 24" title="Mute/Unmute" role="button" tabindex="0" aria-label="Mute or unmute">
      <path id="volume-on" d="M5 9v6h4l5 5V4L9 9H5z" fill="white"/>
      <path id="volume-off" d="M16.5 12l4.5 4.5-1.5 1.5L15 13.5l-4.5 4.5-1.5-1.5L13.5 12 9 7.5l1.5-1.5L15 10.5l4.5-4.5 1.5 1.5L16.5 12z" fill="white" style="display:none"/>
    </svg>
  </div>

<script>
(() => {
  const carousel = document.getElementById('carousel');
  const playbackUI = document.getElementById('playback-ui');
  const playbackControls = {
    exit: document.getElementById('btn-exit'),
    rewind: document.getElementById('btn-rewind'),
    playpause: document.getElementById('btn-playpause'),
    forward: document.getElementById('btn-forward'),
    mute: document.getElementById('btn-mute'),
    playIcon: document.getElementById('play-icon'),
    pauseIcon1: document.getElementById('pause-icon'),
    pauseIcon2: document.getElementById('pause-icon2'),
    volumeOn: document.getElementById('volume-on'),
    volumeOff: document.getElementById('volume-off')
  };

  let items = [];
  let rotationY = 0;
  let dragging = false;
  let dragStartX = 0;
  let currentRotationStart = 0;

  let openedVideo = null;
  let openedVideoIndex = -1;
  let openedImageIndex = -1; // for image open state

  let easterEggActive = false;
  let easterEggKeyBuffer = [];
  const easterEggSequence = ['g', 'g', 'g', 'g'];

  // Track last mouse drag time to prevent click after drag (fix accidental open)
  let lastDragTime = 0;

  // Setup carousel rotation positions
  function updateCarouselPositions() {
    const len = items.length;
    const angleStep = 360 / len;
    const radius = 350;
    items.forEach((item, i) => {
      // Calculate rotation for each item
      const angle = i * angleStep + rotationY;
      // Convert degrees to radians
      const rad = angle * Math.PI / 180;

      // Position in 3D circle
      const x = radius * Math.sin(rad);
      const z = radius * Math.cos(rad);

      // Apply 3D transform
      item.style.transform = `translateX(${x}px) translateZ(${z}px) translateY(-50%) scale(0.85)`;
      item.style.opacity = z > 0 ? 1 : 0.3;
      item.style.zIndex = Math.round(z);
    });
  }

  // Create a carousel item from an image or video src
  function createCarouselItem(src, type) {
    const div = document.createElement('div');
    div.classList.add('carousel-item');

    if(type === 'video') {
      const video = document.createElement('video');
      video.src = src;
      video.preload = 'metadata';
      video.muted = true; // default muted for no auto audio
      video.loop = true;
      video.playsInline = true;
      video.style.pointerEvents = 'none'; // prevent direct controls
      video.setAttribute('webkit-playsinline', ''); // ios support
      div.appendChild(video);
      video.load();

      // fix stutter with play in background - autoplay muted
      video.play().catch(() => {});
    } else {
      const img = document.createElement('img');
      img.src = src;
      img.draggable = false;
      div.appendChild(img);
    }
    carousel.appendChild(div);
    items.push(div);
    updateCarouselPositions();
  }

  // Drag handlers for rotating carousel smoothly (no snap)
  carousel.addEventListener('mousedown', e => {
    if(e.button !== 0) return; // left click only
    dragging = true;
    dragStartX = e.clientX;
    currentRotationStart = rotationY;
    carousel.style.transition = 'none';
    e.preventDefault();
  });
  window.addEventListener('mouseup', e => {
    if(!dragging) return;
    dragging = false;
    lastDragTime = Date.now(); // FIX: update lastDragTime here
    carousel.style.transition = 'transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
  });
  window.addEventListener('mousemove', e => {
    if(!dragging) return;
    const deltaX = e.clientX - dragStartX;
    rotationY = currentRotationStart + deltaX * 0.3;
    carousel.style.transform = `translateZ(-350px) rotateY(${rotationY}deg)`;
    updateCarouselPositions();
  });

  // Scroll wheel to rotate carousel (CTRL to zoom later if wanted)
  carousel.addEventListener('wheel', e => {
    e.preventDefault();
    // Ignore accidental clicks on mouseup by setting a timeout
    if (dragging) return;
    rotationY += e.deltaY * 0.5;
    carousel.style.transition = 'transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    carousel.style.transform = `translateZ(-350px) rotateY(${rotationY}deg)`;
    updateCarouselPositions();
  }, { passive: false });

  // Open video or image on click with smooth animation
  carousel.addEventListener('click', e => {
    if (dragging) return;
    if (Date.now() - lastDragTime < 300) return; // Ignore clicks right after drag

    let targetItem = e.target.closest('.carousel-item');
    if (!targetItem) return;

    // If already opened, clicking the open image closes it
    if (openedImageIndex !== -1) {
      if (items[openedImageIndex] === targetItem) {
        closePlayback();
      }
      return;
    }

    if(openedVideo) return; // Already opened video - block opening another

    const index = items.indexOf(targetItem);
    if(index === -1) return;

    // Only allow video or image
    const video = targetItem.querySelector('video');
    if(video) {
      openVideoPlayback(video, index);
    } else {
      openImageView(targetItem, index);
    }
  });

  // Opens video playback UI and animates layout
  function openVideoPlayback(videoEl, index) {
    openedVideo = videoEl;
    openedVideoIndex = index;
    openedImageIndex = -1;

    // Make sure video controls hidden, we'll show our UI
    videoEl.muted = false;
    videoEl.pause();
    videoEl.currentTime = 0;
    videoEl.style.pointerEvents = 'auto';
    videoEl.play();

    // Animate carousel items: clicked video center + scale up,
    // others move down with fade out
    items.forEach((item, i) => {
      if(i === index) {
        item.style.transition = 'transform 0.5s ease, opacity 0.5s ease';
        item.style.transform = 'translate3d(0, 0, 0) scale(1.6)';
        item.style.zIndex = 10000;
        item.style.opacity = 1;
      } else {
        item.style.transition = 'transform 0.5s ease, opacity 0.5s ease';
        item.style.transform = 'translate3d(0, 200px, 0) scale(0.8)';
        item.style.opacity = 0.15;
        item.style.zIndex = 0;
      }
    });

    playbackUI.classList.add('visible');
    updatePlayPauseIcon(true);
  }

  // Open image view (just zoom center, no playback UI)
  function openImageView(item, index) {
    openedVideo = null;
    openedVideoIndex = -1;
    openedImageIndex = index;

    items.forEach((el, i) => {
      if(i === index) {
        el.style.transition = 'transform 0.5s ease, opacity 0.5s ease';
        el.style.transform = 'translate3d(0, 0, 0) scale(1.6)';
        el.style.zIndex = 10000;
        el.style.opacity = 1;
      } else {
        el.style.transition = 'transform 0.5s ease, opacity 0.5s ease';
        el.style.transform = 'translate3d(0, 200px, 0) scale(0.8)';
        el.style.opacity = 0.15;
        el.style.zIndex = 0;
      }
    });

    playbackUI.classList.remove('visible');
  }

  // Close playback / image view, reset carousel
  function closePlayback() {
    if(openedVideo) {
      openedVideo.pause();
      openedVideo.style.pointerEvents = 'none';
      openedVideo = null;
      openedVideoIndex = -1;
    }
    openedImageIndex = -1;
    playbackUI.classList.remove('visible');
    items.forEach(item => {
      item.style.transition = 'transform 0.5s ease, opacity 0.5s ease';
      item.style.transform = '';
      item.style.opacity = 1;
      item.style.zIndex = '';
    });
    updateCarouselPositions();
  }

  // Playback UI controls
  playbackControls.exit.addEventListener('click', closePlayback);
  playbackControls.exit.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      closePlayback();
    }
  });

  playbackControls.playpause.addEventListener('click', togglePlayPause);
  playbackControls.playpause.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      togglePlayPause();
    }
  });

  playbackControls.rewind.addEventListener('click', () => {
    if(openedVideo) openedVideo.currentTime = Math.max(0, openedVideo.currentTime - 10);
  });
  playbackControls.forward.addEventListener('click', () => {
    if(openedVideo) openedVideo.currentTime = Math.min(openedVideo.duration, openedVideo.currentTime + 10);
  });

  playbackControls.mute.addEventListener('click', toggleMute);
  playbackControls.mute.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleMute();
    }
  });

  // Keyboard shortcuts
  window.addEventListener('keydown', e => {
    // Prevent input fields or editable divs from interfering
    if(e.target.isContentEditable || e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

    // Close playback with ESC
    if(e.key === 'Escape') {
      closePlayback();
      return;
    }

    // Easter egg key buffer
    if(!easterEggActive) {
      easterEggKeyBuffer.push(e.key.toLowerCase());
      if(easterEggKeyBuffer.length > easterEggSequence.length) {
        easterEggKeyBuffer.shift();
      }
      if(easterEggKeyBuffer.join('') === easterEggSequence.join('')) {
        activateEasterEgg();
      }
    }
  });

  // Play/Pause toggle
  function togglePlayPause() {
    if(!openedVideo) return;
    if(openedVideo.paused) {
      openedVideo.play();
      updatePlayPauseIcon(true);
    } else {
      openedVideo.pause();
      updatePlayPauseIcon(false);
    }
  }

  // Mute toggle
  function toggleMute() {
    if(!openedVideo) return;
    openedVideo.muted = !openedVideo.muted;
    updateMuteIcon(openedVideo.muted);
  }

  function updatePlayPauseIcon(isPlaying) {
    playbackControls.playIcon.style.display = isPlaying ? 'none' : 'block';
    playbackControls.pauseIcon1.style.display = isPlaying ? 'block' : 'none';
    playbackControls.pauseIcon2.style.display = isPlaying ? 'block' : 'none';
  }
  function updateMuteIcon(isMuted) {
    playbackControls.volumeOn.style.display = isMuted ? 'none' : 'block';
    playbackControls.volumeOff.style.display = isMuted ? 'block' : 'none';
  }

  // Easter egg: play song, hide images, flash colors, then revert
  let easterEggTimeout;
  const easterEggSongURL = 'https://raw.githubusercontent.com/basilisezkid23/Infinete-Canvas/main/Lensko%20-%20Let%27s%20Go_%20_%20House%20_%20NCS%20-%20Copyright%20Free%20Music%20%5BmSLuJYtl89Y%5D.mp3';
  const easterEggAudio = new Audio(easterEggSongURL);
  easterEggAudio.loop = false;

  function activateEasterEgg() {
    easterEggActive = true;
    easterEggKeyBuffer = [];

    // Hide all carousel items (images/videos)
    items.forEach(item => {
      item.style.transition = 'opacity 0.5s ease';
      item.style.opacity = '0';
    });

    // Play song
    easterEggAudio.currentTime = 0;
    easterEggAudio.play();

    // Flash background colors with body class
    document.body.classList.add('easter-egg-flash');

    // After 20 seconds stop everything and reset
    easterEggTimeout = setTimeout(() => {
      easterEggAudio.pause();
      document.body.classList.remove('easter-egg-flash');

      // Show items again
      items.forEach(item => {
        item.style.opacity = '1';
      });

      easterEggActive = false;
    }, 20000);
  }

  // Initial carousel setup
  function init() {
    // Add your images/videos here - example
    createCarouselItem('https://i.imgur.com/5bQvtxO.jpg', 'image'); // sample image
    createCarouselItem('https://i.imgur.com/qDqXeIk.jpg', 'image'); // sample image
    createCarouselItem('https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm', 'video'); // sample video
    createCarouselItem('https://interactive-examples.mdn.mozilla.net/media/cc0-videos/bee.webm', 'video'); // sample video
    createCarouselItem('https://i.imgur.com/7A9iSmV.jpg', 'image'); // sample image

    // Center carousel at start
    rotationY = 0;
    carousel.style.transform = `translateZ(-350px) rotateY(${rotationY}deg)`;
    updateCarouselPositions();
  }

  init();

})();
</script>
</body>
</html>
